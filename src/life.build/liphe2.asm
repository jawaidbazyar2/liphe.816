** Liphe2.SRC**  Part 2 of the neverending Saga of LIPHE-816 Commands               MCOPY liphe2.macrosCH             gequ $00VC             gequ $02BASL           gequ $04   ; this var is 3-4 bytes long.BASH           gequ $05KEYBOARD       GEQU $E0C000KEYSTROBE      GEQU $E0C010DoRandom       START               using Junk               using GlobalData               using Buffers               _HideCursor               stz CH          ;clear it out, we'sa gonna randomize!               stz VC               stz Population  ;make sure this is clear               PushLong #0               _GetTick               _SetRandSeed               ldx #83         ;toolbox routines trash registers!NextRandCell   phx             ;save x temporarily               PushWord #0               _Random               pla               plx               cmp #$8000      ;if greater than this then stay dead               bcs DontLive               lda #$0001               sta StatBuf,x               inc Population               lda #1               jsr PlotDot               bra Dont2DontLive       lda #0               sta StatBuf,x               lda #0               jsr PlotDotDont2          inc CH               inx               lda CH               cmp #80               bcc NextRandCell               lda #0               sta CH               inc VC               inx               inx               lda VC               cmp #44               bcc NextRandCell               LDA #12               STA CH               ldx Population               jsr LINPRT               _ShowCursor               rts               ENDDoAbout        START               using WindowData               using GlobalData               PushLong AboutWinPtr               _SelectWindow               PushLong AboutWinPtr               _ShowWindow               PushLong AboutWinPtr               _SetPort               PushWord #5               PushWord #10               _MoveTo               PushLong #String1               _DrawCString               PushWord #5               PushWord #35               _MoveTo               PushLong #String2               _DrawCString               PushWord #5               PushWord #48               _MoveTo               PushLong #String3               _DrawCString               PushWord #5               PushWord #58               _MoveTo               PushLong #String35               _DrawCString               PushWord #5               PushWord #68               _MoveTo               PushLong #String4               _DrawCStringLooper         PushWord #0               PushWord #$1FFF               PushLong #TaskRecord               _GetNextEvent               pla               beq Looper               lda EventWhat               cmp #1          ;mouse down!               bne Looper               PushLong AboutWinPtr               _HideWindow               PushLong UnivPtr               _SelectWindow               PushLong UnivPtr               _SetPort               rts     ;the screen update should come thru Event ManagerString1        dc c'LIPHE-816 v1.1',i1'0'String2        dc c'(c) 1989 by Jawaid Bazyar',i1'0'String3        dc c'All Rights Reserved',i1'0'String35       dc c'This program is FreeWare',i1'0'String4        dc c'Click mouse button',i1'0'               ENDLoadSaveDat    DATA               using BuffersLoadText       str 'Choose file to load'SaveText       str 'Type name to save as'defname        str 'untitled'ReplyRec       anopRRStatus       dc i2'0'RRfiletype     dc i2'0'RRauxtype      dc i2'0'RRfname        ds 16RRpname        ds 129CreatePB       dc i4'RRfname'               dc h'C300'               dc h'0600'               dc i4'0'        ;auxtype- change later if we get a thing               dc i2'1'               dc i2'0'        ;date and time are zero, i.e. supplied by               dc i2'0'        ;clockDeletePB       dc i4'RRfname'  ;we may need to delete it it already exists.SetFileInfoPB  dc i4'RRfname'               dc i2'$C3'               dc i2'$06'               dc i4'0'               dc i2'0'        ;null               dc i4'0'        ;date and time               dc i4'0'        ;mod dateOpenPB         dc i2'0'               dc i4'RRfname'               dc i4'0'ReadWritePB    dc i2'0'               dc i4'StatBuf'               dc i4'$1000'               dc i4'0'TypeList       dc i1'1'               dc i1'6'               ENDDoSave         START               using LoadSaveDat               PushWord #40    ;x-coord               PushWord #30    ;y-coord               PushLong #SaveText               PushLong #defname               PushWord #15    ;default               PushLong #ReplyRec               _SFPutFile               lda RRStatus               beq QuitSaveAgain          _CREATE CreatePB        ;try to create the new file               bcc OkS1               cmp #7               beq Again               ;prodos is busy               cmp #$47                ;duplicate path               beq DupErrHndlErr        brk 00DupErr         _SET_FILE_INFO SetFileInfoPB               _DESTROY DeletePB        ;delete the troublesome file               bra AgainOkS1           _OPEN OpenPB               bcs HndlErr               lda OpenPB               sta ReadWritePB               _WRITE ReadWritePB               _CLOSE OpenPB           ;har har, we cheated!QuitSave       rts               ENDDoLoad         START               using LoadSaveDat               using Buffers               using Junk               PushWord #40               PushWord #30               PushLong #LoadText               PushLong #0             ;no filter procedure               PushLong #TypeList               PushLong #ReplyRec      ;har har               _SFGetFile               lda RRStatus               beq QuitLoad               _OPEN OpenPB               bcs QuitLoad               lda OpenPB               sta ReadWritePB               _READ ReadWritePB               _CLOSE OpenPB               ldx #0                  ;we must count the population               ldy #0CountPop       lda StatBuf,x               and #$00FF              ;clear out the high bit               beq NextCnt               inyNextCnt        inx               cpx #$0FFF              ;not necessary, but what the hell.               bne CountPop               sty Population               LDA #12                 ;print the new population               STA CH               ldx Population               jsr LINPRTQuitLoad       rts               END* The Following data segment is the bitmap for the characters* we use to display information about Life.*   xxx.  .x..  xxx.  xxx.  x.x.  xxx.  x...  xxx.  xxx.  xxx.*   x.x.  xx..  ..x.  ..x.  x.x.  x...  x...  ..x.  x.x.  x.x.*   x.x.  .x..  .x..  xxx.  xxx.  xxx.  xxx.  ..x.  xxx.  xxx.*   x.x.  .x..  x...  ..x.  ..x.  ..x.  x.x.  .x..  x.x.  ..x.*   xxx.  xxx   xxx   xxx.  ..x.  xxx.  xxx.  .x..  xxx.  .x..Numbers        DATALine1          dc h'000F'      ;0               dc h'F0FF'      ;1               dc h'000F'      ;2               dc h'000F'      ;3               dc h'0F0F'      ;4               dc h'000F'      ;5               dc h'0FFF'      ;6               dc h'000F'      ;7               dc h'000F'      ;8               dc h'000F'      ;9Line2          dc h'0F0F'      ;0               dc h'00FF'      ;1               dc h'FF0F'      ;2               dc h'FF0F'      ;3               dc h'0F0F'      ;4               dc h'0FFF'      ;5               dc h'0FFF'      ;6               dc h'FF0F'      ;7               dc h'0F0F'      ;8               dc h'0F0F'      ;9Line3          dc h'0F0F'      ;0               dc h'F0FF'      ;1               dc h'F0FF'      ;2               dc h'000F'      ;3               dc h'000F'      ;4               dc h'000F'      ;5               dc h'000F'      ;6               dc h'FF0F'      ;7               dc h'000F'      ;8               dc h'000F'      ;9Line4          dc h'0F0F'      ;0               dc h'F0FF'      ;1               dc h'0FFF'      ;2               dc h'FF0F'      ;3               dc h'FF0F'      ;4               dc h'FF0F'      ;5               dc h'0F0F'      ;6               dc h'F0FF'      ;7               dc h'0F0F'      ;8               dc h'FF0F'      ;9Line5          dc h'000F'      ;0               dc h'000F'      ;1               dc h'000F'      ;2               dc h'000F'      ;3               dc h'FF0F'      ;4               dc h'000F'      ;5               dc h'000F'      ;6               dc h'F0FF'      ;7               dc h'000F'      ;8               dc h'F0FF'      ;9               END