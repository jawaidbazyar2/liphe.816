*********************** LIFE DRIVER 1.0 ***********************; DSECT ORG $00GENNO DS 2POPULATION DS 2CNT1 DS 2CNT2 DS 2CELLB DS 2CELLD DS 2TEMPC DS 1 DEND;CH EQU $057B VC EQU $25BASL EQU $28CINPLT EQU $38DOSHOOK EQU $03EACHARINV EQU $CEDDKEYBOARD EQU $C000KEYSTROBE EQU $C010SWITCH EQU $C054LINPRT EQU $ED24PRBLNK EQU $F948VTABZ EQU $FC24;* This stuff is totally unneccesary, but I'll leave it in for now. ORG $6000  JMP GENGO; JMP CLRARY3VTAB LDX VC DEX TXA JMP VTABZNEXTGEN        LDA #0        ; do one new generation               STA CELLB     ;set number of births and deaths to zero               STA CELLB+1               STA CELLD               STA CELLD+1               LDA #$00      ; set pointer to beginning of neighbors array               STA CNT2               LDA #$50                STA CNT2+1               LDA #$53      ; do same for current status array               STA CNT1               LDA #$40               STA CNT1+1               LDA #1        ; set cursor to 1,1               STA CH               STA VC               JSR CLRARY    ; clear out the neighbors arrayCHECKCELL      LDY #0               LDA (CNT1),Y  ; if this cell is dead, don't add to               BEQ DEAD      ; neighbors count of cells around us               LDY #0               CLC           ; otherwise, increase the neighbor count               LDA (CNT2),Y  ; all around us by one               ADC #1               STA (CNT2),Y               INY               LDA (CNT2),Y               ADC #1               STA (CNT2),Y               INY               LDA (CNT2),Y               ADC #1               STA (CNT2),Y               LDY #$52               LDA (CNT2),Y               ADC #1               STA (CNT2),Y               LDY #$54               LDA (CNT2),Y               ADC #1               STA (CNT2),Y               LDY #$A4               LDA (CNT2),Y               ADC #1               STA (CNT2),Y               INY               LDA (CNT2),Y               ADC #1               STA (CNT2),Y               INY               LDA (CNT2),Y               ADC #1               STA (CNT2),Y      ; done incrementing neighbor countDEAD           INC CH            ; keep track of where we are by counting               LDA CH            ; with CH               CMP #81               BCS DONELINE      ; if we're not at the end of the line then               INC CNT1          ; add one to each position number               BNE DOCNT2               INC CNT1+1DOCNT2         INC CNT2               BNE CHECKCELL               INC CNT2+1               BNE CHECKCELLDONELINE       LDA #1            ; since we're at the end of the line,               STA CH            ; we add three to CNT1 to skip               INC VC            ; the edge boundaries.               LDA VC               CMP #24           ; if we're done with the screen...               BCS DONESCR               LDA #3               CLC               ADC CNT1               STA CNT1               LDA CNT1+1               ADC #0               STA CNT1+1               LDA #3               CLC               ADC CNT2               STA CNT2               LDA CNT2+1               ADC #0               STA CNT2+1               JMP CHECKCELL    ; go do it some more;DONE WITH SCAN,NOW DO SCREEN UPDATEDONESCR        LDA #$50         ; re-set a few pointers.               STA CNT2+1               LDA #$53               STA CNT1               STA CNT2               LDA #$40               STA CNT1+1               LDA #1               STA CH               STA VC               JSR VTABLOOPIT         LDY #0           ; skip through the data we collected.               LDA (CNT1),Y               BEQ DEADCS       ; if the cell is currently alive               LDA (CNT2),Y     ; and we have two or three neighbors, leave               CMP #2           ; it alone otherwise kill it.               BEQ NEXTONE               CMP #3               BEQ NEXTONE               LDA #0               STA (CNT1),Y               LDY CH               DEY               LDA #' '        ; kill the puppy               JSR STORCHAR               INC CELLD       ; inc the number of cells killed               BNE NEXTONE               INC CELLD+1               BNE NEXTONEDEADCS         LDA (CNT2),Y    ; the cell was dead, see if we bring it to               CMP #3          ; LIFE...har har               BNE NEXTONE               LDA #1               STA (CNT1),Y               LDY CH               DEY               LDA #'*'        ; if so then change it to a living dude               JSR STORCHAR               INC CELLB       ; inc cell born               BNE NEXTONE               INC CELLB+1     ;note that if a cell doesn't change statusNEXTONE        INC CH          ;it's not re-done               LDA CH               CMP #81               BCS DONELIN1               INC CNT1               INC CNT2               BNE X1               INC CNT1+1               INC CNT2+1X1             JMP LOOPITDONELIN1       LDA #1               STA CH               INC VC               JSR VTAB               LDA VC               CMP #24                BCS DONESCR2               LDA #3               CLC               ADC CNT1               STA CNT1               STA CNT2               PHP               LDA CNT1+1               ADC #0               STA CNT1+1               PLP               LDA CNT2+1               ADC #0               STA CNT2+1               JMP LOOPITDONESCR2       RTS;; DID THAT ONE OKGENGO          JSR NEXTGEN               INC GENNO               BNE GENG1               INC GENNO+1GENG1          LDA #23               JSR VTABZ               LDA #32                STA CH               LDX GENNO               LDA GENNO+1               JSR LINPRT               JSR PRBLNK               LDA CELLB               CLC               ADC POPULATION               STA POPULATION               LDA CELLB+1               ADC POPULATION+1               STA POPULATION+1               LDA POPULATION               SEC               SBC CELLD               STA POPULATION               LDA POPULATION+1               SBC CELLD+1               STA POPULATION+1               LDA #12                STA CH               LDX POPULATION               LDA POPULATION+1               JSR LINPRT     ;LINE # PRINT               JSR PRBLNK               LDA KEYBOARD               CMP #$9B               BEQ QUITGEN               LDA POPULATION               ORA POPULATION+1               BEQ QUITGEN               LDA CELLB               ORA CELLB+1               ORA CELLD               ORA CELLD+1               BEQ QUITGEN               JMP GENGOQUITGEN        STA KEYSTROBE               RTSCLRARY         LDY #0               TYACLRARY1        STA $4F00,Y               STA $5000,Y               STA $5100,Y               STA $5200,Y               STA $5300,Y               STA $5400,Y               STA $5500,Y               STA $5600,Y               STA $5800,Y               STA $5700,Y               INY               BNE CLRARY1               RTS;;THIS IS THE CLEAR ROUTINE USED FROM THE BASIC PROGRAM ;CLRARY3        LDY #0               TYACLRARY2        STA $4000,Y               STA $4100,Y               STA $4200,Y               STA $4300,Y               STA $4400,Y               STA $4500,Y               STA $4600,Y               STA $4700,Y               INY               BNE CLRARY2               STA $4800               STA $4801               STA $4802               RTSSTORCHAR       PHA               AND #$FF               BMI ST5E8B               LDA $04FB               ROR A                PLA               PHA               BCC ST5E8B               BIT $C01E               BPL ST5E8B               EOR #$40               BIT BITLOC                BEQ ST5E8B               EOR #$40ST5E8B         BIT $C01F               BPL ST5EAD               STA $C001               PHA               STY $2A               TYA               EOR $20               LSR A                BCS ST5EA0               LDA $C055               INYST5EA0         TYA               LSR A                TAY               PLA               STA ($28),Y               LDA $C054               LDY $2A               PLABITLOC         RTSST5EAD         STA ($28),Y               PLA               RTS