****************************************                                     **       Life Driver Version 2.0       **                                     **      65816 Conversion: 3-30-89      **                                     **          by Jawaid Bazyar           **                                     ****************************************               msb on** Direct Page LocationsCH             gequ $00VC             gequ $02BASL           gequ $04   ; this var is 3-4 bytes long.BASH           gequ $05KEYBOARD       GEQU $E0C000KEYSTROBE      GEQU $E0C010SizeX          gequ 80SizeY          gequ 44PowTen         DATAPowTenTab      dc I2'10000'               dc I2'1000'               dc I2'100'               dc I2'10'               dc I2'1'               ENDJunk           DATAGENNO          dc I2'0'POPULATION     dc i2'0'CELLB          dc i2'0'CELLD          dc i2'0'TEMPC          dc i1'0'               END**Buffers        DATAStatBuf        ds $1000NeighBuf       ds $1000               END* all regs in full 16-bit mode* set direct page register to whatever direct page we got from the MM* earlier.NextGen        START               using Junk               using Buffers*               stz CellBorn  ; do one new generation*               stz CellDied  ;set number of births and deaths to zero               longa off               LDA #0          ; set cursor to 1,1               STA CH               STA VC* accumulator to 8-bit modeCHECKCELL      ldx #$0000Check1         LDA StatBuf+$53,x ; if this cell is dead, don't add to               BEQ DEAD          ; neighbors count of cells around us               INC NeighBuf,x               inc NeighBuf+1,x               inc NeighBuf+2,x               inc NeighBuf+$52,x               inc NeighBuf+$54,x               inc NeighBuf+$A4,x               inc NeighBuf+$A5,x               inc NeighBuf+$A6,x* otherwise, increase the neighbor count* all around us by oneDEAD           INC CH            ; keep track of where we are by counting               LDA CH            ; with CH               CMP #SizeX               BCS DONELINE      ; if we're not at the end of the line then               inx               bra Check1        ; increment our positionDONELINE       LDA #0            ; since we're at the end of the line,               STA CH            ; we add three to CNT1 to skip               INC VC            ; the edge boundaries.               LDA VC               CMP #SizeY        ; if we're done with the screen...               BCS DONESCR               inx              ; inc this up to the next line               inx               inx               bra CHECK1       ; go do it some more* if, in general, code shrinks like this when converted from 6502* to 65816 then perhaps it is a worthwhile cause.*DONE WITH SCAN,NOW DO SCREEN UPDATEDONESCR        LDA #0               STA CH               STA VC               ldx #$0053       ; set up the index again.               ldy Population   ; keep track of this FAST with y regLOOPIT         lda StatBuf,x    ; skip through the data we collected               BEQ DEADCS       ; if the cell is currently alive               lda NeighBuf,x   ; and we have two or three neighbors, leave               CMP #2           ; it alone otherwise kill it.               BEQ IncLife               CMP #3               BEQ IncLife               stz StatBuf,x    ; kill the sucker!               LONGA ON               rep #$20               LDA #0           ; kill the puppy               JSR PlotDot               LONGA OFF               sep #$20               dey             ; a cell was killed               INC CELLD       ; inc the number of cells killed               BNE NEXTONE               INC CELLD+1               BNE NEXTONEIncLife        lda StatBuf,x               cmp #4               bcs NEXTONE               inc a               sta StatBuf,xIncPlot        LONGA ON               rep #$20               and #$00FF               jsr PlotDot               LONGA OFF               sep #$20               bra NEXTONEDEADCS         lda NeighBuf,x  ; the cell was dead, see if we bring it to               CMP #3          ; LIFE...har har               BNE NEXTONE               lda #1               sta StatBuf,x               LONGA ON               rep #$20               LDA #1          ; if so then change it to a living dude               JSR PlotDot               LONGA OFF               sep #$20               iny             ; a cell was born               INC CELLB       ; inc cell born               BNE NEXTONE               INC CELLB+1     ;note that if a cell doesn't change statusNEXTONE        stz NeighBuf,x   ;clear it out for next time!!!               INC CH          ;it's not re-done               inx               LDA CH               CMP #SizeX               BCS DONELIN1               bra LOOPITDONELIN1       LDA #0               STA CH               INC VC               LDA VC               CMP #SizeY               BCS DONESCR2               inx               inx               bra LOOPITDONESCR2       sty Population               rts               END; DID THAT ONE OKLIFERUN        START               using Junk               using Buffers               JSR CLRARY      ; make sure the neighbors array is clear               LONGA OFF               sep #$20GENGO          JSR NEXTGEN               INC GENNO               bne Gengot1               inc GENNO+1Gengot1        LDA #23               sta VC;              JSR VTAB               LDA #32                STA CH               LDX GENNO;              JSR LINPRT      ; this is a clever routine* here was the code to add CELLB and CELLD to Population.               lda KEYBOARD               bpl hhh               cmp #$9B        ;esc?!?!               beq QUITGEN               lda KEYSTROBEhhh            LDA #12               STA CH               LDX POPULATION      ; 16 bit indices, remember?               JSR LINPRT          ; LINE # PRINT               lda #24               STA CH               ldx CELLB               jsr LINPRT               lda #30               sta CH               ldx CELLD               jsr LINPRT               LDX POPULATION               BEQ QUITGEN               LDA CELLB               ORA CELLB+1               ORA CELLD               ORA CELLD+1               BEQ QUITGEN               ldx #0               stx CELLB               stx CELLD               bra GENGOQUITGEN        STA KEYSTROBE               RTS***  CLRARY - zeros out the neighbors array***  Full NativeCLRARY         LDY #0             ; this routine clears out the               TYA                ; to make sure. This routine is only usedCLRARY1        STA NeighBuf,Y     ; once at the beginning of each round.               STA NeighBuf+$0200,Y               STA NeighBuf+$0400,Y               STA NeighBuf+$0600,Y               STA NeighBuf+$0800,Y               STA NeighBuf+$0A00,Y               STA NeighBuf+$0C00,Y               STA NeighBuf+$0E00,Y               INY               iny               cpy #$200               BNE CLRARY1               RTS               END***   This little ditty stores our character in the appropriate place***   in banks $E0 and $E1STORCHAR       START               phy               pha               ldy #$00E0        ; the default bank number               lda CH               dea               and #$01               bne STOR1               inySTOR1          sty BASL+2        ; save the bank number               lda CH               dea               lsr a             ; divide by two to get actual location               sta YFix               ldy YFix               pla               sta [BASL],y               ply               rtsYFix           dc I2'0'               ENDVTAB           START               lda VC               deaBASCALC        pha               lsr a               and #$03               ora #$04               sta BASH               pla               and #$18               bcc BASCLC2               adc #$7FBASCLC2        sta BASL               asl a               asl a               ora BASL               sta BASL               rts               END* "It's forever-more that I wait...* "So sad it ends, as it began...LINPRT         START               using PowTen               using NumbersCH             equ $00               php               LONGA ON               rep #$30               txa                ;trans the byte over to Acc               ldx #0NxtDigit       ldy #0LinChk         cmp PowTenTab,x               bcc DoneDigit      ; digit power is > A, so go to next dig               sec               sbc PowTenTab,x               iny                ; increase digit               bra LinChkDoneDigit      pha               phx               tya               asl a              ; mult by two               tay               lda CH               asl a               tax               lda Line1,y               sta $E19940,x               lda Line2,y               sta $E199E0,x               lda Line3,y               sta $E19A80,x               lda Line4,y               sta $E19B20,x               lda Line5,y               sta $E19BC0,x               plx               pla               inc CH               inx               inx               cpx #10               bcc NxtDigit               plp               rts               END